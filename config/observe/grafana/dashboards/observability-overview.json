{
  "id": null,
  "title": "Seraphim Observability Overview",
  "tags": ["seraphim", "observability", "metrics", "logs", "traces"],
  "style": "dark",
  "timezone": "browser",
  "editable": true,
  "graphTooltip": 1,
  "schemaVersion": 36,
  "version": 1,
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"],
    "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d"]
  },
  "refresh": "10s",
  "templating": {
    "list": [
      {
        "allValue": ".*",
        "current": {
          "selected": true,
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "prometheus",
          "uid": "prometheus"
        },
        "definition": "label_values(seraphim_inference_requests_total, job)",
        "hide": 0,
        "includeAll": true,
        "label": "Service",
        "multi": false,
        "name": "service",
        "options": [],
        "query": "label_values(seraphim_inference_requests_total, job)",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      }
    ]
  },
  "annotations": {
    "list": []
  },
  "panels": [
    {
      "type": "row",
      "title": "Service Level Indicators (SLIs)",
      "id": 100,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0},
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "Requests per Second",
      "id": 1,
      "gridPos": {"h": 4, "w": 4, "x": 0, "y": 1},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "sum(rate(seraphim_inference_requests_total[1m]))",
          "legendFormat": "RPS",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps", 
          "decimals": 2, 
          "color": {"mode": "thresholds"},
          "thresholds": {
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 10},
              {"color": "red", "value": 100}
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {"calcs": ["lastNotNull"]},
        "orientation": "auto",
        "textMode": "auto"
      }
    },
    {
      "type": "stat",
      "title": "Error Rate",
      "id": 2,
      "gridPos": {"h": 4, "w": 4, "x": 4, "y": 1},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "(sum(rate(seraphim_inference_requests_total{outcome!=\"success\"}[5m])) / sum(rate(seraphim_inference_requests_total[5m]))) * 100",
          "legendFormat": "Error %",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent", 
          "decimals": 2,
          "color": {"mode": "thresholds"},
          "thresholds": {
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 1},
              {"color": "red", "value": 5}
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {"calcs": ["lastNotNull"]},
        "orientation": "auto",
        "textMode": "auto"
      }
    },
    {
      "type": "stat",
      "title": "P95 Latency",
      "id": 3,
      "gridPos": {"h": 4, "w": 4, "x": 8, "y": 1},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(seraphim_inference_latency_seconds_bucket[5m]))) * 1000",
          "legendFormat": "P95 ms",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms", 
          "decimals": 1,
          "color": {"mode": "thresholds"},
          "thresholds": {
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 100},
              {"color": "red", "value": 500}
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {"calcs": ["lastNotNull"]},
        "orientation": "auto",
        "textMode": "auto"
      }
    },
    {
      "type": "stat",
      "title": "Total Requests (1m)",
      "id": 4,
      "gridPos": {"h": 4, "w": 4, "x": 12, "y": 1},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "sum(increase(seraphim_inference_requests_total[1m]))",
          "legendFormat": "Requests",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short", 
          "decimals": 0, 
          "color": {"mode": "thresholds"}
        }
      },
      "options": {
        "reduceOptions": {"calcs": ["lastNotNull"]},
        "orientation": "auto",
        "textMode": "auto"
      }
    },
    {
      "type": "stat", 
      "title": "Error Requests (5m)",
      "id": 5,
      "gridPos": {"h": 4, "w": 4, "x": 16, "y": 1},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "sum(increase(seraphim_inference_requests_total{outcome!=\"success\"}[5m]))",
          "legendFormat": "Error Requests",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 0,
          "color": {"mode": "thresholds"},
          "thresholds": {
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 1},
              {"color": "red", "value": 5}
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {"calcs": ["lastNotNull"]},
        "orientation": "auto",
        "textMode": "auto"
      }
    },
    {
      "type": "stat",
      "title": "Canary Traffic %",
      "id": 6,
      "gridPos": {"h": 4, "w": 4, "x": 20, "y": 1},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "100 * (sum(rate(seraphim_inference_requests_total{variant=\"candidate\"}[1m])) or vector(0)) / (sum(rate(seraphim_inference_requests_total[1m])) or vector(1))",
          "legendFormat": "Canary %",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent", 
          "decimals": 1, 
          "color": {"mode": "thresholds"}
        }
      },
      "options": {
        "reduceOptions": {"calcs": ["lastNotNull"]},
        "orientation": "auto",
        "textMode": "auto"
      }
    },

    {
      "type": "row",
      "title": "Request Flow & Performance",
      "id": 200,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 5},
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Request Rate by Variant",
      "id": 10,
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "sum by (variant) (rate(seraphim_inference_requests_total[1m]))",
          "legendFormat": "{{variant}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps", 
          "decimals": 2
        }
      },
      "options": {
        "legend": {
          "displayMode": "table", 
          "values": ["current", "max"]
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Response Time Percentiles",
      "id": 11,
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum by (le) (rate(seraphim_inference_latency_seconds_bucket[5m]))) * 1000",
          "legendFormat": "P50",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(seraphim_inference_latency_seconds_bucket[5m]))) * 1000",
          "legendFormat": "P95",
          "refId": "B"
        },
        {
          "expr": "histogram_quantile(0.99, sum by (le) (rate(seraphim_inference_latency_seconds_bucket[5m]))) * 1000",
          "legendFormat": "P99",
          "refId": "C"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms", 
          "decimals": 1
        }
      },
      "options": {
        "legend": {
          "displayMode": "table", 
          "values": ["current", "max"]
        }
      }
    },

    {
      "type": "row",
      "title": "Distributed Tracing",
      "id": 300,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 14},
      "collapsed": false
    },
    {
      "type": "traces",
      "title": "Recent Traces",
      "id": 30,
      "gridPos": {"h": 10, "w": 24, "x": 0, "y": 15},
      "datasource": {
        "type": "jaeger",
        "uid": "jaeger"
      },
      "targets": [
        {
          "query": "seraphim-inference",
          "queryType": "",
          "refId": "A"
        }
      ],
      "options": {
        "showTracesVolume": false
      }
    },

    {
      "type": "row",
      "title": "Application Logs",
      "id": 400,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 25},
      "collapsed": false
    },
    {
      "type": "logs",
      "title": "Application Logs",
      "id": 40,
      "gridPos": {"h": 10, "w": 12, "x": 0, "y": 26},
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "targets": [
        {
          "expr": "{job=\"seraphim-inference\"}",
          "refId": "A"
        }
      ],
      "options": {
        "showTime": true,
        "showLabels": false,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "enableLogDetails": true,
        "dedupStrategy": "none",
        "sortOrder": "Descending"
      }
    },
    {
      "type": "logs",
      "title": "Error Logs",
      "id": 41,
      "gridPos": {"h": 10, "w": 12, "x": 12, "y": 26},
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "targets": [
        {
          "expr": "{job=\"seraphim-inference\"} |~ \"ERROR\"",
          "refId": "A"
        }
      ],
      "options": {
        "showTime": true,
        "showLabels": false,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "enableLogDetails": true,
        "dedupStrategy": "none",
        "sortOrder": "Descending"
      }
    },

    {
      "type": "row",
      "title": "Log Analytics",
      "id": 500,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 36},
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Request Rate by Variant",
      "id": 50,
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 37},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "sum by (variant) (rate(seraphim_inference_requests_total[1m]))",
          "legendFormat": "{{variant}} requests",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "cps", 
          "decimals": 0
        }
      },
      "options": {
        "legend": {
          "displayMode": "table", 
          "values": ["current", "max"]
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Request Outcomes", 
      "id": 51,
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 37},
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "targets": [
        {
          "expr": "sum by (outcome) (rate(seraphim_inference_requests_total[1m]))",
          "legendFormat": "{{outcome}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "cps", 
          "decimals": 0
        }
      },
      "options": {
        "legend": {
          "displayMode": "table", 
          "values": ["current", "max"]
        }
      }
    }
  ]
}
